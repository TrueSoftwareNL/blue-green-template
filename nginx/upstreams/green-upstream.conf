# Green environment upstream definition
# Used when green is the active deployment color
# The switch script copies this file to active-upstream.conf and reloads Nginx
upstream active_app {
    zone active_app_zone 64k;

    # Docker DNS resolves 'app_green' to all replica container IPs (round-robin)
    # 'resolve' re-queries DNS periodically to pick up new/removed replicas
    server app_green:3000 max_fails=3 fail_timeout=30s resolve;

    # Keep persistent connections to app for better performance
    keepalive 32;
}
