# =============================================================================
# ACTIVE UPSTREAM â€” DO NOT EDIT MANUALLY
# =============================================================================
# This file is managed by scripts/switch-environment.sh
# It is a copy of either blue-upstream.conf or green-upstream.conf
# To switch: ./scripts/switch-environment.sh [blue|green]
# =============================================================================

# Blue environment upstream definition (default active)
upstream active_app {
    zone active_app_zone 64k;

    # Docker DNS resolves 'app_blue' to all replica container IPs (round-robin)
    # 'resolve' re-queries DNS periodically to pick up new/removed replicas
    server app_blue:3000 max_fails=3 fail_timeout=30s resolve;

    # Keep persistent connections to app for better performance
    keepalive 32;
}
